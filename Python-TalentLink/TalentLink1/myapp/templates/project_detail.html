<!DOCTYPE html>
<html>
<head>
    <title>Project Detail</title>
    <style>
        body {
            background: linear-gradient(135deg,#0f1117,#1e293b);
            font-family: "Segoe UI", sans-serif;
            color: #e5e7eb;
            padding: 30px;
        }

        h2, h3 { margin-bottom: 15px; }

        .project-card, .proposal-card, .form-box, .status-box {
            background: #0f172a;
            padding: 20px;
            border-radius: 14px;
            margin-bottom: 20px;
        }

        .label {
            color: #94a3b8;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .skills span {
            display: inline-block;
            background: #1e40af;
            color: #dbeafe;
            padding: 5px 10px;
            border-radius: 14px;
            font-size: 12px;
            margin: 3px 4px 3px 0;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        .green { background: #22c55e; color: #022c22; }
        .red { background: #ef4444; color: #020617; }

        .proposal-card {
            background: #1e293b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 12px;
        }

        .proposal-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 6px;
        }

        .pending { background: #facc15; color: #3b2f0b; }
        .accepted { background: #22c55e; color: #022c22; }
        .rejected { background: #ef4444; color: #020617; }

        .form-box input,
        .form-box textarea,
        .form-box button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: none;
            font-size: 14px;
        }

        .form-box button {
            background: #4ecdc4;
            color: #020617;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- ================= PROJECT INFO ================= -->
<div class="project-card">
    <h2>{{ project.title }}</h2>
    <p>{{ project.description }}</p>
    <p><b>Budget:</b> ‚Çπ{{ project.budget }}</p>
    <p><b>Deadline:</b> {{ project.deadline }}</p>
    <p><b>Duration:</b> {{ project.duration }} days</p>

    <div class="label">Skills Required</div>
    <div class="skills">
        {% for skill in project.skills_required.all %}
            <span>{{ skill.name }}</span>
        {% empty %}
            <span>Not specified</span>
        {% endfor %}
    </div>
</div>

<hr>

<!-- ================= CLIENT VIEW ================= -->
{% if is_client %}
<h3>Freelancer Proposals</h3>

{% for p in proposals %}
<div class="proposal-card">
    <p><b>Freelancer:</b> {{ p.freelancer.username }}</p>
    <p><b>Cover Letter:</b> {{ p.cover_letter }}</p>
    <p><b>Bid:</b> ‚Çπ{{ p.bid_amount }}</p>

    <span class="proposal-status {{ p.status|lower }}">
        {{ p.status }}
    </span>

    {% if p.status == "PENDING" %}
    <div style="margin-top:12px;">
        <a href="{% url 'accept_proposal' p.id %}">
            <button class="btn green">Accept</button>
        </a>
        <a href="{% url 'reject_proposal' p.id %}">
            <button class="btn red">Reject</button>
        </a>
    </div>
    {% endif %}
</div>
{% empty %}
<p>No proposals yet.</p>
{% endfor %}
{% endif %}

<!-- ================= FREELANCER VIEW ================= -->
{% if not is_client %}

{% if user_proposal %}
<div class="status-box">
    <h3>Your Proposal Status</h3>

    <p><b>Client:</b> {{ project.client.username }}</p>

    <span class="proposal-status {{ user_proposal.status|lower }}">
        {{ user_proposal.status }}
    </span>

    {% if user_proposal.status == "PENDING" %}
        <p style="margin-top:10px; color:#facc15;">
            Waiting for client response
        </p>
    {% elif user_proposal.status == "ACCEPTED" %}
        <p style="margin-top:10px; color:#22c55e;">
            üéâ Proposal accepted by client
        </p>
    {% elif user_proposal.status == "REJECTED" %}
        <p style="margin-top:10px; color:#ef4444;">
            ‚ùå Proposal rejected by client
        </p>
    {% endif %}
</div>
{% endif %}

<!-- SUBMIT PROPOSAL -->
{% if not user_proposal %}
<h3>Submit Your Proposal</h3>
<div class="form-box">
    <form method="post" action="{% url 'submit_proposal' project.pk %}">
        {% csrf_token %}
        <textarea name="cover_letter" placeholder="Cover Letter" required></textarea>
        <input type="number" name="bid_amount" placeholder="Bid Amount" required>
        <button type="submit">Submit Proposal</button>
    </form>
</div>
{% endif %}

{% endif %}

</body>
</html>
