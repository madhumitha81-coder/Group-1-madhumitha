<!DOCTYPE html>
<html>
<head>
    <title>Project Detail - {{ project.title }}</title>
    <style>
        body {
            background: linear-gradient(135deg,#0f1117,#1e293b);
            font-family: "Segoe UI", sans-serif;
            color: #e5e7eb;
            padding: 30px;
        }

        h2, h3 { margin-bottom: 15px; }

        /* ===== DASHBOARD BUTTON ===== */
        .top-bar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .dashboard-btn {
            background: #38bdf8;
            color: #020617;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: bold;
            text-decoration: none;
        }

        .dashboard-btn:hover {
            opacity: 0.9;
        }

        .project-card, .proposal-card, .status-box {
            background: #0f172a;
            padding: 20px;
            border-radius: 14px;
            margin-bottom: 20px;
        }

        .label { color: #94a3b8; font-size: 13px; margin-bottom: 6px; }

        .skills span {
            display: inline-block;
            background: #1e40af;
            color: #dbeafe;
            padding: 5px 10px;
            border-radius: 14px;
            font-size: 12px;
            margin: 3px 4px 3px 0;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            text-decoration: none;
        }

        .green { background: #22c55e; color: #022c22; }
        .red { background: #ef4444; color: #020617; }
        .yellow { background: #facc15; color: #3b2f0b; }
        .blue { background: #38bdf8; color: #020617; }

        .proposal-card {
            background: #1e293b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 12px;
        }

        .proposal-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 6px;
        }

        .pending { background: #facc15; color: #3b2f0b; }
        .accepted { background: #22c55e; color: #022c22; }
        .rejected { background: #ef4444; color: #020617; }

        .status-box p { margin: 6px 0; }
    </style>
</head>
<body>

<!-- ===== DASHBOARD NAV ===== -->
<div class="top-bar">
    {% if is_client %}
        <a href="{% url 'client_dashboard' %}" class="dashboard-btn">Go to Dashboard</a>
    {% else %}
        <a href="{% url 'freelancer_dashboard' %}" class="dashboard-btn">Go to Dashboard</a>
    {% endif %}
</div>

<!-- ================= PROJECT INFO ================= -->
<div class="project-card">
    <h2>{{ project.title }}</h2>
    <p>{{ project.description }}</p>
    <p><b>Budget:</b> ₹{{ project.budget }}</p>
    <p><b>Deadline:</b> {{ project.deadline }}</p>
    <p><b>Duration:</b> {{ project.duration }} days</p>

    <div class="label">Skills Required</div>
    <div class="skills">
        {% for skill in project.skills_required.all %}
            <span>{{ skill.name }}</span>
        {% empty %}
            <span>Not specified</span>
        {% endfor %}
    </div>
</div>

<hr>

<!-- ================= CLIENT VIEW ================= -->
{% if is_client %}
<h3>Freelancer Proposals</h3>
{% for p in proposals %}
<div class="proposal-card">
    <p><b>Freelancer:</b> {{ p.freelancer.user.username }}</p>
    <p><b>Cover Letter:</b> {{ p.cover_letter }}</p>
    <p><b>Bid:</b> ₹{{ p.bid_amount }}</p>

    <span class="proposal-status {{ p.status|lower }}">{{ p.status }}</span>

    {% if p.status == "PENDING" %}
    <div style="margin-top:12px;">
        <form method="post" action="{% url 'update_proposal_status' p.id %}">
            {% csrf_token %}
            <button name="status" value="ACCEPTED" class="btn green">Accept</button>
            <button name="status" value="REJECTED" class="btn red">Reject</button>
            <button name="status" value="PENDING" class="btn yellow">Pending</button>
        </form>
    </div>
    {% endif %}
</div>
{% empty %}
<p>No proposals yet.</p>
{% endfor %}
{% endif %}

<!-- ================= FREELANCER VIEW ================= -->
{% if not is_client and user_proposal %}
<div class="status-box">
    <h3>Your Proposal Status</h3>
    <p><b>Client:</b> {{ project.client.username }}</p>
    <p><b>Status:</b>
        <span class="proposal-status {{ user_proposal.status|lower }}">
            {{ user_proposal.status }}
        </span>
    </p>

    {% if user_proposal.status == "ACCEPTED" and user_proposal.contract %}
        <a href="{% url 'contract_chat' user_proposal.contract.id %}" class="btn green">
            Go to Contract Chat
        </a>
    {% endif %}
</div>
{% endif %}

</body>
</html>
